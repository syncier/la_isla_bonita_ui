on:
  push:
    branches:
    - master
  pull_request:

name: Build & Test

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - uses: actions/setup-java@v1
      with:
        java-version: '12.x'
    - uses: subosito/flutter-action@v1
      with:
        channel: 'stable'
    # - run: flutter pub get
    # # - run: flutter analyze
    # # - run: flutter test
    # - run: flutter build apk --target-platform android-arm64 --split-per-abi

    - run: echo $JK_STORE_FILE | base64 -d > android/app/lib_key.jks
      name: set environment from secrets
      env:
        JK_STORE_FILE: ${{ secrets.JK_STORE_FILE_TWAIV }}
    - uses: ruby/setup-ruby@v1
      with:
        ruby-version: '2.7'
    - uses: maierj/fastlane-action@v2.0.1
      with:
        lane: 'build_android'
        subdirectory: 'android'
        bundle-install-path: 'vendor/bundle'
      env:
        JK_PASSWORD: ${{ secrets.JK_PASSWORD }}
        JK_ALIAS: "key"
        JK_STORE_PASSWORD: ${{ secrets.JK_STORE_PASSWORD }}
        SUPPLY_JSON_KEY_DATA: ${{ secrets.SUPPLY_JSON_KEY_DATA }}
        KEY_PATH: lib_key.jks
